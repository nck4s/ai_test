# Автотесты для проверки состава атмосферы планет на Wikipedia

Проект содержит автотесты на Playwright + pytest для проверки состава атмосферы планет на ru.wikipedia.org.

## Требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)

## Установка

1. **Создайте виртуальное окружение:**

   ```bash
   python -m venv venv
   ```

2. **Активируйте виртуальное окружение:**

   **Windows:**

   ```bash
   venv\Scripts\activate
   ```

   **Linux/Mac:**

   ```bash
   source venv/bin/activate
   ```

3. **Установите зависимости:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Установите браузеры для Playwright:**
   ```bash
   playwright install
   ```

## Запуск тестов

**Важно:** Перед запуском тестов убедитесь, что виртуальное окружение активировано!

**Windows (PowerShell):**

```bash
.\venv\Scripts\Activate.ps1
```

**Windows (CMD):**

```bash
venv\Scripts\activate.bat
```

**Linux/Mac:**

```bash
source venv/bin/activate
```

После активации в начале строки терминала появится `(venv)`.

### Запуск тестов в видимом режиме (headed mode)

```bash
pytest -q --headed
```

### Запуск всех тестов

```bash
pytest
```

### Запуск конкретного теста

```bash
pytest tests/test_wiki_atmosphere.py::TestWikipediaAtmosphere::test_earth_atmosphere_oxygen_positive
pytest tests/test_wiki_atmosphere.py::TestWikipediaAtmosphere::test_mars_atmosphere_oxygen_negative
```

### Запуск с подробным выводом

```bash
pytest -v
```

## Структура проекта

```
testpr/
├── requirements.txt          # Зависимости проекта
├── pytest.ini                # Конфигурация pytest
├── tests/
│   └── test_wiki_atmosphere.py  # Тестовые сценарии
└── README.md                 # Документация
```

## Описание тестов

### Тест 1: Позитивный тест (Земля)

- Находит статью "Земля" на ru.wikipedia.org
- Переходит по ссылке "Атмосфера Земли"
- Ищет таблицу "Состав сухого воздуха" по caption
- Находит строку "Кислород" по th
- Проверяет, что значение кислорода ≈ 20,95% с допуском ±0,2%

### Тест 2: Негативный тест (Марс)

- Находит статью "Марс" на ru.wikipedia.org
- Переходит по ссылке "Атмосфера Марса"
- Ищет таблицу с составом атмосферы
- Находит строку "Кислород"
- Проверяет, что значение НЕ попадает в диапазон 20,5–21,5%

## Особенности реализации

- **Стабильные локаторы:** Используются caption для поиска таблиц и th для поиска строк
- **Утилита parse_percent:** Обрабатывает как запятую, так и точку в процентных значениях
- **Ожидания:** Все действия выполняются с явными ожиданиями загрузки элементов
- **Навигация:** Отслеживаются переходы между страницами с проверкой URL и заголовков
- **Headed режим:** Браузер отображается видимым для возможности записи экрана

## Устранение неполадок

### Проблема: Браузер не запускается

- Убедитесь, что установлены браузеры: `playwright install chromium`
- Проверьте, что Python версии 3.10+

### Проблема: Тесты падают с таймаутом

- Проверьте интернет-соединение
- Увеличьте таймауты в коде тестов (параметр `timeout`)

### Проблема: Не находятся элементы

- Убедитесь, что структура страниц Wikipedia не изменилась
- Проверьте, что тесты запускаются в headed режиме для визуальной отладки

### Проблема: Команда pytest не найдена

- Убедитесь, что виртуальное окружение активировано (должно быть `(venv)` в начале строки)
- Активируйте виртуальное окружение: `.\venv\Scripts\Activate.ps1` (Windows PowerShell) или `venv\Scripts\activate.bat` (Windows CMD)
- Если в PowerShell возникает ошибка выполнения скриптов, выполните: `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`
